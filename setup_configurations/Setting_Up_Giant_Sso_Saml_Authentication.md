# Configuring GIANT to use external Identity Provider via SAML 2.0
Setting up GIANT to make use of an existing Identity Provider through SAML 2.0 token exchange

## Getting Started

This guide will get you through the steps necessary to setup your GIANT to communicate with your existing identity provider,
by leveraging on SAML 2.0 token exchange protocol. If you are not familiar with SAML 2.0, have a look at [here](https://www.oasis-open.org/standards#samlv2.0) for more details.

### Prerequisites
- A running GIANT application
- User with administration rights, or rights to configure the System Configuration under the Manage System module.


### Configuring SSO Identity Provider
1. Browse To Configure System menu under Manage System.
![Manage System](https://github.com/fx-giant/giant-documentations/blob/master/setup_configurations/images/Setting_Up_Giant_Sso_Saml_Authentication_01.png)

2. Using the search field, search for the “SSO Identity Provider” module.
![SSO Search Field](https://github.com/fx-giant/giant-documentations/blob/master/setup_configurations/images/Setting_Up_Giant_Sso_Saml_Authentication_02.png)

3. Enter the configuration values and save the changes made.
![Properties](https://github.com/fx-giant/giant-documentations/blob/master/setup_configurations/images/Setting_Up_Giant_Sso_Saml_Authentication_03.png)

 Property|Description
-|-
|Provider Url| Redirection url where GIANT will invoke during authentication period |
|Public key| Public key of the given identity provider website to allow GIANT to identify if the given SAML response is valid



### Identity Provider Integration Explanation
Currently, GIANT supports SAML 2.0 Post Base Redirection. This is due to GIANT enforces a given SAML response and request token to be presigned.

> **Note**: All tokens communicated over are required to attach a valid configured x502 certificate, to ensure that the authenticity of the given SAML Response.

Below is an example of a signed SAML Request generated by GIANT.

```Xml
<samlp:SamlRequest ForceAuthn="false" IsPassive="false" ID="_062B5BCC2749FD52CB960D6D87C6891E" Version="2.0" IssueInstant="2017-12-07T04:16:46.355Z" 
    Destination="http://my.identityprovider.com/SingleSignOnService/" ProtocolBinding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" 
    AssertionConsumerServiceIndex="0" 
    AssertionConsumerServiceURL="http://my.giant.com/AssertionService?binding=urn%3aoasis%3anames%3atc%3aSAML%3a2.0%3abindings%3aHTTP-POST" 
    AttributeConsumingServiceIndex="0" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <samlp:NameIDPolicy AllowCreate="true" />
    <saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">http://my.giant.com/</saml:Issuer>
    <Signature xmlns="http://www.w3.org/2000/09/xmldsig#">
        <SignedInfo>
            <CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
            <SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
            <Reference URI="#_062B5BCC2749FD52CB960D6D87C6891E">
                <Transforms>
                    <Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
                    <Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#">
                        <InclusiveNamespaces PrefixList="#default saml ds xs xsi" xmlns="http://www.w3.org/2001/10/xml-exc-c14n#" />
                    </Transform>
                </Transforms>
                <DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
                <DigestValue>OK+rFHc7lhWRZA7mh3eMBVtnCIw=</DigestValue>
            </Reference>
        </SignedInfo>
        <SignatureValue>******</SignatureValue>
        <KeyInfo>
            <X509Data>
                <X509Certificate>****</X509Certificate>
            </X509Data>
        </KeyInfo>
    </Signature>
</samlp:SamlRequest>
```

Note: All SAML 2.0 communication are done using form post, to ensure the xml is not being flagged as violation. 

> **Note**: SAML during transport state are Base64 encoded bytes

Once the given Identity Provider has validate and verified the given user, the given Identity Provider is required to send back a signed SAML Response as shown in the example below:


```Xml
<samlp:Response ID="_4F4C32FB9133CBCB4A7C08635550921F" Version="2.0" IssueInstant="2017-12-07T04:22:06.475Z" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">http://my.identityprovider.com/</saml:Issuer>
    <Signature xmlns="http://www.w3.org/2000/09/xmldsig#">
        <SignedInfo>
            <CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
            <SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
            <Reference URI="#_4F4C32FB9133CBCB4A7C08635550921F">
                <Transforms>
                    <Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
                    <Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#">
                        <InclusiveNamespaces PrefixList="#default saml ds xs xsi" xmlns="http://www.w3.org/2001/10/xml-exc-c14n#" />
                    </Transform>
                </Transforms>
                <DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
                <DigestValue>6r4KMKo6dwY488/kUJnol25cs/I=</DigestValue>
            </Reference>
        </SignedInfo>
        <SignatureValue>****</SignatureValue>
        <KeyInfo>
            <X509Data>
                <X509Certificate>****</X509Certificate>
            </X509Data>
        </KeyInfo>
    </Signature>
    <samlp:Status>
        <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success" />
    </samlp:Status>
    <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">
        <saml:Subject>
            <saml:NameID>Batman@waynetech.com</saml:NameID>
        </saml:Subject>
        <saml:AuthnStatement AuthnInstant="2017-12-07T04:22:06.477Z" />
    </saml:Assertion>
</samlp:Response>
```

> **Note**: The NameID must be matchable to an existing GIANT username, which in most cases are a valid email address.