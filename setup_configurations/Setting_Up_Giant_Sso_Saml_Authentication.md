# Configuring Giant to use external identity provider via SAML 2.0
Setting up giant to make use of an existing identity provider through SAML 2.0 token exchange

## Getting Started

This guide will get you through the steps necessary to setup your giant to comunicate with your existing identity provider,
by leveraging on SAML 2.0 token exchange protocol. If you are not familiar with saml 2.0, have a look at [here](https://www.oasis-open.org/standards#samlv2.0)

### Prerequisites
- A running giant application
- User with administration rights, or rights to configure mission control


### Configuring Sso Identity Provider
1. Browse To Mission Control
<Insert image from home page on the left panel and highlight as red>

2. Filter missing control to display “SSO Identity Provider”
<Insert image for mission control page with sso Configuration module as filter>

3. Provide the configuration value and save
<Insert image for mission control  sso Configuration module properties>


 Property|Description
-|-
|Provider Url| Redirection url where giant will invoke during authentication period |
|Public key| Public key of the given identity provider website to allow giant to identify if the given saml response is valid



### Identity provider integration explanation
Currently giant support Saml 2.0 Post base redirection. Due to giant enforces a given saml response and request token to be presign.

> **Note**: All tokens comunicated over are required to attached a valid configured x502 certificate, to ensure the authenticity of the given saml Response.

```Xml
<samlp:SamlRequest ForceAuthn="false" IsPassive="false" ID="_062B5BCC2749FD52CB960D6D87C6891E" Version="2.0" IssueInstant="2017-12-07T04:16:46.355Z" 
    Destination="http://my.identityprovider.com/SingleSignOnService/" ProtocolBinding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" 
    AssertionConsumerServiceIndex="0" 
    AssertionConsumerServiceURL="http://my.giant.com/AssertionService?binding=urn%3aoasis%3anames%3atc%3aSAML%3a2.0%3abindings%3aHTTP-POST" 
    AttributeConsumingServiceIndex="0" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <samlp:NameIDPolicy AllowCreate="true" />
    <saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">http://my.giant.com/</saml:Issuer>
    <Signature xmlns="http://www.w3.org/2000/09/xmldsig#">
        <SignedInfo>
            <CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
            <SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
            <Reference URI="#_062B5BCC2749FD52CB960D6D87C6891E">
                <Transforms>
                    <Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
                    <Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#">
                        <InclusiveNamespaces PrefixList="#default saml ds xs xsi" xmlns="http://www.w3.org/2001/10/xml-exc-c14n#" />
                    </Transform>
                </Transforms>
                <DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
                <DigestValue>OK+rFHc7lhWRZA7mh3eMBVtnCIw=</DigestValue>
            </Reference>
        </SignedInfo>
        <SignatureValue>******</SignatureValue>
        <KeyInfo>
            <X509Data>
                <X509Certificate>****</X509Certificate>
            </X509Data>
        </KeyInfo>
    </Signature>
</samlp:SamlRequest>
```

An example of a signed Saml Request generated by giant. 
Note: all saml2.0 comunication are done using form post, to ensure xml is not being flag as violation, 

> **Note**: saml during transport state are being Base64 encoded bytes

Once the given Identity provider has validate and verfieid the given user. The given identity provider is required to send back a signed Saml Response.


```Xml
<samlp:Response ID="_4F4C32FB9133CBCB4A7C08635550921F" Version="2.0" IssueInstant="2017-12-07T04:22:06.475Z" xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol">
    <saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">http://my.identityprovider.com/</saml:Issuer>
    <Signature xmlns="http://www.w3.org/2000/09/xmldsig#">
        <SignedInfo>
            <CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#" />
            <SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1" />
            <Reference URI="#_4F4C32FB9133CBCB4A7C08635550921F">
                <Transforms>
                    <Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature" />
                    <Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#">
                        <InclusiveNamespaces PrefixList="#default saml ds xs xsi" xmlns="http://www.w3.org/2001/10/xml-exc-c14n#" />
                    </Transform>
                </Transforms>
                <DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1" />
                <DigestValue>6r4KMKo6dwY488/kUJnol25cs/I=</DigestValue>
            </Reference>
        </SignedInfo>
        <SignatureValue>****</SignatureValue>
        <KeyInfo>
            <X509Data>
                <X509Certificate>****</X509Certificate>
            </X509Data>
        </KeyInfo>
    </Signature>
    <samlp:Status>
        <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success" />
    </samlp:Status>
    <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">
        <saml:Subject>
            <saml:NameID>Batman@waynetech.com</saml:NameID>
        </saml:Subject>
        <saml:AuthnStatement AuthnInstant="2017-12-07T04:22:06.477Z" />
    </saml:Assertion>
</samlp:Response>
```

> **Note**: NameId must be matchable to an existing Giant username, which in most case is a valid email address.